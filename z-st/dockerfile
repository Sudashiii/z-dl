# ----------------------------
# 1. Base stage
# ----------------------------
FROM node:20-alpine

# Set working directory
WORKDIR /app

# Copy package files first (better caching)
COPY package.json ./

# Install dependencies (no dev deps for production)
RUN npm i --omit=dev

# Copy the rest of your source code
COPY . .

# Set environment to production
ENV NODE_ENV=production

# Expose the port your Express app runs on
EXPOSE 1900

# Start the Express app
CMD ["npx", "tsx", "express.ts"]